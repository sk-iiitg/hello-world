name: Deploy

on:
  schedule:
    - cron: '8 14 * * 1-5'
  workflow_dispatch: {}
  push:
    branches-ignore:
      - bors/*.tmp
      - master # Deploys happen before merge with bors.
jobs:
  env:
    name: Env
    runs-on: ubuntu-latest
    steps:
      - name: Run
        id: run
        run: |
          ./deploy.sh \
            --dry-run=${{ needs.env.outputs.apply != 'true' }} \
            --safe=${{ vars.SAFE != 'false' }} \
            ${{ needs.env.outputs.apply != 'true' && '--base-commit=origin/master' || '' }} \
            ${{ needs.env.outputs.environment == 'dev' && github.event_name != 'schedule' && '--base-commit=origin/master' || '' }} \
            ci
